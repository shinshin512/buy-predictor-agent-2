# Survey Feature Engineering Tool

## ğŸ“‹ æ¦‚è¿°

é€™æ˜¯ä¸€å€‹é€šç”¨çš„å•å·èª¿æŸ¥ç‰¹å¾µå·¥ç¨‹å·¥å…·ï¼Œå¯ä»¥ï¼š
1. å¾å¤–éƒ¨æª”æ¡ˆè®€å– CSV è·¯å¾‘æ¸…å–®
2. **æ ¹æ“šè‡ªè¨‚ç¾¤çµ„æ¨™ç±¤åˆ†çµ„ç”¢ç”Ÿç¨ç«‹çš„ output CSV**
3. ä½¿ç”¨ Gemini 2.5 Flash LLM è‡ªå‹•è­˜åˆ¥å•å·å•é¡Œæ¬„ä½
4. è‡ªå‹•è½‰æ›ä¸åŒæ ¼å¼çš„ CSV æ¬„ä½
5. ç”¢ç”Ÿ 45+ å€‹å…¬å¸å±¤ç´šç‰¹å¾µ
6. **å€åˆ†ã€Œå•é¡Œä¸åœ¨å•å·ä¸­ã€vsã€Œå•é¡Œåœ¨ä½†æ²’å›ç­”ã€**

---

## ğŸ“ è³‡æ–™å¤¾çµæ§‹

```
survey_feature_engineering/
â”œâ”€â”€ .env                    # API é‡‘é‘°ï¼ˆä¸å¯åˆ†äº«ï¼ï¼‰
â”œâ”€â”€ .gitignore              # å¿½ç•¥æ•æ„Ÿæª”æ¡ˆ
â”œâ”€â”€ main.py                 # ä¸»ç¨‹å¼
â”œâ”€â”€ files.txt               # è¼¸å…¥ï¼šç¾¤çµ„:è·¯å¾‘ æ ¼å¼çš„æ¸…å–®
â”œâ”€â”€ README.md               # æœ¬æ–‡ä»¶
â”œâ”€â”€ requirements.txt        # Python ä¾è³´å¥—ä»¶
â””â”€â”€ output/                 # è¼¸å‡ºè³‡æ–™å¤¾
    â”œâ”€â”€ erp_company_features.csv
    â”œâ”€â”€ erp_question_mapping.json
    â”œâ”€â”€ owlsome_company_features.csv
    â””â”€â”€ owlsome_question_mapping.json
```

---

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### 1. å®‰è£ä¾è³´

```bash
pip install -r requirements.txt
```

### 2. è¨­å®š API é‡‘é‘°

ç·¨è¼¯ `.env` æª”æ¡ˆï¼Œè¨­å®šä½ çš„ Gemini API é‡‘é‘°ï¼š

```
GEMINI_API_KEY=ä½ çš„APIé‡‘é‘°
```

âš ï¸ **é‡è¦**ï¼š`.env` æª”æ¡ˆåŒ…å«æ•æ„Ÿè³‡è¨Šï¼Œä¸è¦åˆ†äº«æˆ–ä¸Šå‚³åˆ°ç‰ˆæœ¬æ§åˆ¶ç³»çµ±ï¼

### 3. è¨­å®šè¼¸å…¥æª”æ¡ˆæ¸…å–®

ç·¨è¼¯ `files.txt`ï¼Œä½¿ç”¨ `ç¾¤çµ„åç¨±:ç›¸å°è·¯å¾‘` æ ¼å¼ï¼š

```
erp:erp_sample\æª”æ¡ˆ1.csv
erp:erp_sample\æª”æ¡ˆ2.csv
owlsome:owlsome_tech1\æª”æ¡ˆ3.csv
owlsome:owlsome_tech2\æª”æ¡ˆ4.csv
```

**é‡é»èªªæ˜ï¼š**
- ä½¿ç”¨ `:` åˆ†éš”ç¾¤çµ„åç¨±èˆ‡æª”æ¡ˆè·¯å¾‘
- **ç›¸åŒç¾¤çµ„åç¨±çš„æª”æ¡ˆæœƒåˆä½µè™•ç†ï¼Œç”¢ç”ŸåŒä¸€å€‹ output CSV**
- ä¾‹å¦‚ï¼š`owlsome_tech1` å’Œ `owlsome_tech2` éƒ½æ¨™ç‚º `owlsome:`ï¼Œæœƒåˆä½µæˆ `owlsome_company_features.csv`
- æ”¯æ´è·¨è³‡æ–™å¤¾çš„æª”æ¡ˆåˆä½µï¼Œåªè¦ç¾¤çµ„åç¨±ç›¸åŒ

### 4. åŸ·è¡Œç¨‹å¼

```bash
cd survey_feature_engineering
python main.py
```

æˆ–ä½¿ç”¨è™›æ“¬ç’°å¢ƒï¼š

```bash
cd survey_feature_engineering
..\.venv\Scripts\python.exe main.py
```

---

## ğŸ“Š è¼¸å‡ºæ ¼å¼

### å…¬å¸ç‰¹å¾µ CSV (`{ç¾¤çµ„åç¨±}_company_features.csv`)

æ¯å€‹å…¬å¸ä¸€åˆ—ï¼ŒåŒ…å«ï¼š

#### åŸºç¤ç‰¹å¾µ (45 å€‹)

| é¡åˆ¥ | ç‰¹å¾µ | èªªæ˜ |
|------|------|------|
| åŸºæœ¬è³‡è¨Š | `company_id`, `survey_name`, `total_calls` | å…¬å¸è­˜åˆ¥èˆ‡é€šè©±æ¬¡æ•¸ |
| ç›®æ¨™è®Šæ•¸ | `completed_survey` | æ˜¯å¦å®Œæˆå•å· |
| é€šè©±æ¨¡å¼ | `call_sequence_max`, `days_between_calls_*` | é€šè©±åºåˆ—èˆ‡é–“éš” |
| æ™‚é–“ç‰¹å¾µ | `morning_calls_ratio`, `afternoon_calls_ratio` | æ—©ä¸Š/ä¸‹åˆé€šè©±æ¯”ä¾‹ |
| ç‹€æ…‹æ¨¡å¼ | `cannot_contact_ratio`, `refused_ratio` | ç„¡æ³•è¯ç¹«/æ‹’çµ•æ¯”ä¾‹ |
| æ—©æœŸäº’å‹• | `early_cannot_contact`, `early_response_rate` | å‰å…©é€šé›»è©±çš„è¡¨ç¾ |
| å…¬å¸ç‰¹æ€§ | `company_size`, `company_size_category`, `capital_millions` | è¦æ¨¡èˆ‡è³‡æœ¬ |
| è¯çµ¡å“è³ª | `contacted_it_dept`, `contacted_manager`, `contacted_director` | æ˜¯å¦è¯ç¹«åˆ°é—œéµäºº |
| Email åˆ†æ | `has_email`, `has_work_email`, `has_personal_email` | Email æä¾›æƒ…æ³ |
| å•å·æ·±åº¦ | `max_questions_answered`, `has_survey_responses` | å›ç­”å•é¡Œæ•¸é‡ |
| å‚™è¨» | `has_notes`, `notes_ratio` | æ˜¯å¦æœ‰å‚™è¨» |

#### å•å·å•é¡Œæ¬„ä½ (`Q_å•é¡Œåç¨±`)

- æ¯å€‹å•å·å•é¡Œä¸€å€‹æ¬„ä½
- æ¬„ä½åç¨±æ ¼å¼ï¼š`Q_ç°¡åŒ–å•é¡Œåç¨±`

**ç‰¹æ®Šæ¨™è¨˜ï¼š**

| æ¨™è¨˜ | æ„ç¾© |
|------|------|
| `[NOT_IN_SURVEY]` | é€™å€‹å•é¡Œ**ä¸åœ¨**è©²å…¬å¸å°æ‡‰çš„å•å·æª”æ¡ˆä¸­ |
| `[NO_ANSWER]` | å•é¡Œ**åœ¨**å•å·ä¸­ï¼Œä½†è©²å…¬å¸**æ²’æœ‰å›ç­”** |
| (å¯¦éš›å›ç­”å…§å®¹) | è©²å…¬å¸å°æ­¤å•é¡Œçš„å›ç­” |

### å•é¡Œå°æ‡‰ JSON (`{ç¾¤çµ„åç¨±}_question_mapping.json`)

è¨˜éŒ„å•é¡Œçš„åŸå§‹æ¬„ä½åç¨±èˆ‡ç°¡åŒ–åç¨±çš„å°æ‡‰é—œä¿‚ï¼š

```json
{
  "question_mappings": {
    "ç°¡åŒ–åç¨±1": "åŸå§‹æ¬„ä½åç¨±1",
    "ç°¡åŒ–åç¨±2": "åŸå§‹æ¬„ä½åç¨±2"
  },
  "questions_by_file": {
    "æª”æ¡ˆ1.csv": ["å•é¡Œ1", "å•é¡Œ2"],
    "æª”æ¡ˆ2.csv": ["å•é¡Œ1", "å•é¡Œ3"]
  },
  "special_markers": {
    "NO_ANSWER": "[NO_ANSWER]",
    "NOT_IN_SURVEY": "[NOT_IN_SURVEY]"
  }
}
```

---

## ğŸ”§ ç¨‹å¼é‹ä½œæµç¨‹

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   files.txt     â”‚
                    â”‚ (ç¾¤çµ„:è·¯å¾‘ æ¸…å–®) â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚      æŒ‰ç¾¤çµ„æ¨™ç±¤åˆ†çµ„æª”æ¡ˆ        â”‚
              â”‚  erp: 5 files                â”‚
              â”‚  owlsome: 2 files            â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚                              â”‚
              â–¼                              â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   è™•ç† erp ç¾¤çµ„  â”‚           â”‚ è™•ç† owlsome ç¾¤çµ„â”‚
    â”‚  (erp_sample)   â”‚           â”‚(tech1 + tech2)  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚                              â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”
    â–¼        â–¼        â–¼           â–¼        â–¼        â–¼
 â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”
 â”‚File 1â”‚ â”‚File 2â”‚ â”‚File nâ”‚   â”‚Tech1 â”‚ â”‚Tech2 â”‚
 â””â”€â”€â”¬â”€â”€â”€â”˜ â””â”€â”€â”¬â”€â”€â”€â”˜ â””â”€â”€â”¬â”€â”€â”€â”˜   â””â”€â”€â”¬â”€â”€â”€â”˜ â””â”€â”€â”¬â”€â”€â”€â”˜
    â”‚        â”‚        â”‚          â”‚
    â–¼        â–¼        â–¼          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å°æ¯å€‹æª”æ¡ˆï¼š                       â”‚
â”‚  1. è¼‰å…¥ CSV                                        â”‚
â”‚  2. LLM è‡ªå‹•å°æ‡‰æ¬„ä½ï¼ˆå¦‚éœ€è¦ï¼‰                        â”‚
â”‚  3. LLM è­˜åˆ¥å•å·å•é¡Œæ¬„ä½                             â”‚
â”‚  4. æ¨™æº–åŒ–å‰è™•ç†                                     â”‚
â”‚  5. å·¥ç¨‹åŒ–é€šè©±å±¤ç´šç‰¹å¾µ                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              åˆä½µåŒç¾¤çµ„çš„æ‰€æœ‰æª”æ¡ˆ                     â”‚
â”‚         è¨˜éŒ„æ¯å€‹æª”æ¡ˆæœ‰å“ªäº›å•é¡Œæ¬„ä½                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               èšåˆç‚ºå…¬å¸å±¤ç´šç‰¹å¾µ                      â”‚
â”‚  - æ¯å€‹å…¬å¸ä¸€åˆ—                                      â”‚
â”‚  - å•é¡Œå›ç­”ï¼šå„ªå…ˆå–æœ‰å›ç­” â†’ å†å–æœ€æ–°è³‡è¨Š               â”‚
â”‚  - æ¨™è¨˜ï¼š[NOT_IN_SURVEY] vs [NO_ANSWER]             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚   è¼¸å‡ºåˆ° output/     â”‚
              â”‚  - CSV ç‰¹å¾µæª”æ¡ˆ      â”‚
              â”‚  - JSON å•é¡Œå°æ‡‰     â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¤– LLM ä½¿ç”¨èªªæ˜

æœ¬å·¥å…·ä½¿ç”¨ **Gemini 2.5 Flash** API åŸ·è¡Œå…©é …ä»»å‹™ï¼š

### 1. æ¬„ä½è‡ªå‹•å°æ‡‰

ç•¶ CSV æ¬„ä½åç¨±èˆ‡é æœŸæ ¼å¼ä¸åŒæ™‚ï¼ŒLLM æœƒè‡ªå‹•ç”¢ç”Ÿå°æ‡‰è¦å‰‡ã€‚

ä¾‹å¦‚ï¼Œå°‡ Owlsome Tech çš„æ¬„ä½å°æ‡‰åˆ°æ¨™æº–æ ¼å¼ï¼š
```python
column_mapping = {
    "Company ID": "Company ID",
    "Call Date": "Call Date",
    "å“¡å·¥äººæ•¸": "å“¡å·¥äººæ•¸",
    ...
}
```

### 2. å•å·å•é¡Œè­˜åˆ¥

LLM åˆ†ææ‰€æœ‰æ¬„ä½åç¨±ï¼Œè­˜åˆ¥å“ªäº›æ˜¯å•å·å•é¡Œï¼š

- ä»¥ `Q` é–‹é ­çš„æ¬„ä½
- åŒ…å« `?` æˆ– `ï¼Ÿ` çš„æ¬„ä½
- è©¢å•æ„è¦‹ã€è¨ˆç•«ã€ä½¿ç”¨æƒ…æ³çš„æ¬„ä½

æ’é™¤ï¼š
- å‚™è¨»æ¬„ä½ï¼ˆ`å‚™è¨»`, `notes`, `remarks`ï¼‰
- è¯çµ¡è³‡è¨Šï¼ˆ`Email`, `é›»è©±`, `éƒ¨é–€`ï¼‰
- é€šè©±è³‡è¨Šï¼ˆ`Call Date`, `Call Time`, `Callç‹€æ…‹`ï¼‰

---

## ğŸ“ˆ ç¯„ä¾‹çµæœ

åŸ·è¡Œå¾Œçš„è¼¸å‡ºç¯„ä¾‹ï¼š

```
================================================================================
âœ… PROCESSING COMPLETE!
================================================================================

Output files saved to: survey_feature_engineering/output
  â€¢ erp_company_features.csv: 6,105 companies, 106 features
  â€¢ owlsome_company_features.csv: 800+ companies (åˆä½µ tech1 + tech2)

ğŸ“‹ Special Markers in Question Columns:
   [NOT_IN_SURVEY] = Question was not in the survey file(s) for this company
   [NO_ANSWER] = Question was in survey but no answer was given
================================================================================
```

---

## âš ï¸ æ³¨æ„äº‹é …

1. **API é‡‘é‘°å®‰å…¨**
   - ä¸è¦å°‡ `.env` æª”æ¡ˆä¸Šå‚³åˆ° Git
   - ä¸è¦åœ¨ç¨‹å¼ç¢¼ä¸­ç¡¬ç·¨ç¢¼ API é‡‘é‘°

2. **æª”æ¡ˆè·¯å¾‘**
   - `files.txt` ä¸­ä½¿ç”¨ç›¸å°è·¯å¾‘
   - è·¯å¾‘ç›¸å°æ–¼ `survey_feature_engineering` çš„ä¸Šå±¤ç›®éŒ„

3. **ç·¨ç¢¼**
   - CSV æª”æ¡ˆä½¿ç”¨ UTF-8-BOM ç·¨ç¢¼è®€å–
   - è¼¸å‡ºæª”æ¡ˆä½¿ç”¨ UTF-8-BOM ç·¨ç¢¼

4. **å¤šæ¬¡å›ç­”è™•ç†**
   - å¦‚æœä¸€å®¶å…¬å¸æœ‰å¤šå€‹é€šè©±è¨˜éŒ„
   - å„ªå…ˆå–æœ‰å›ç­”çš„è¨˜éŒ„
   - å¦‚æœéƒ½æœ‰å›ç­”ï¼Œå–æœ€æ–°çš„

---

## ğŸ”§ è‡ªè¨‚è¨­å®š

### ä¿®æ”¹å•é¡Œè­˜åˆ¥è¦å‰‡

åœ¨ `main.py` çš„ `identify_question_columns` å‡½æ•¸ä¸­èª¿æ•´ LLM promptã€‚

### ä¿®æ”¹æ¬„ä½å°æ‡‰è¦å‰‡

åœ¨ `main.py` çš„ `generate_column_mapping_code` å‡½æ•¸ä¸­èª¿æ•´ LLM promptã€‚

### å¢åŠ æ–°ç‰¹å¾µ

åœ¨ `create_company_features` å‡½æ•¸ä¸­æ–°å¢ç‰¹å¾µè¨ˆç®—é‚è¼¯ã€‚

---

## ğŸ“ ä¾è³´å¥—ä»¶

- `pandas` - è³‡æ–™è™•ç†
- `numpy` - æ•¸å€¼è¨ˆç®—
- `requests` - API å‘¼å«
- `python-dotenv` - ç’°å¢ƒè®Šæ•¸ç®¡ç†

---

## ğŸ“ è¯çµ¡è³‡è¨Š

å¦‚æœ‰å•é¡Œï¼Œè«‹åƒè€ƒç¨‹å¼ç¢¼è¨»è§£æˆ–è¯ç¹«é–‹ç™¼åœ˜éšŠã€‚

---

**æœ€å¾Œæ›´æ–°**: 2025 å¹´ 11 æœˆ
